系统漏洞修复		
1.ICMP时间戳获取
iptables -A INPUT -p ICMP --icmp-type timestamp-request -j DROP
iptables -A INPUT -p ICMP --icmp-type timestamp-reply -j DROP

centos7
firewall-cmd --zone=public --add-icmp-block=timestamp-request
firewall-cmd --zone=public --add-icmp-block=timestamp-reply

2.
create directory dump_dir as '/data';
 select * from dba_directories;
grant read,write on directory dump_dir to DSSJC_LOCAL;

查看用户对应的表空间：
select username,default_tablespace from dba_users  where username='DSSJC_LOCAL';
select tablespace_name,file_id,bytes,file_name from dba_data_files where tablespace_name='DSS_JC_DATA' order by file_id;

DSS_JC_DATA
/data/oracle/oradata/orcl/DSS_JC_data.dbf




查看表空间大小利用率
	SELECT SUM(bytes) / (1024 * 1024) AS free_space, tablespace_name 
	FROM dba_free_space 
	GROUP BY tablespace_name; 


	SELECT a.tablespace_name, 
	a.bytes total, 
	b.bytes used, 
	c.bytes free, 
	(b.bytes * 100) / a.bytes "USED %", 
	(c.bytes * 100) / a.bytes "FREE %" 
	FROM sys.sm$ts_avail a, sys.sm$ts_used b, sys.sm$ts_free c 
	WHERE a.tablespace_name = b.tablespace_name 
	AND a.tablespace_name = c.tablespace_name; 


用户表空间

	#创建表临时空间
	create temporary tablespace DSSJC_LOCAL_TEMP
	tempfile '/u01/app/oracle/oradata/orcl/dssjc_local_temp_data.dbf'
	size 500m
	autoextend on
	next 50m 
	extent management local;



	#创建数据表空间
	create tablespace dssjc_local_data
	logging
	datafile '/u01/app/oracle/oradata/orcl/dssjc_local_data.dbf'
	size 15000m
	autoextend on
	extent management local;

	#创建用户并指定表空间
	create user dssjc_local identified by DssJc_Local2017
	default tablespace dssjc_local_data
	temporary tablespace DSSJC_LOCAL_TEMP;

	#给用户授予权限
	grant EXP_FULL_DATABASE,IMP_FULL_DATABASE,connect,resource to dssjc_local; 

	删除用户和表空间
		步骤一：  删除user
			drop user DSSJC_LOCAL cascade
			说明： 删除了user，只是删除了该user下的schema objects，是不会删除相应的tablespace的。
		步骤二： 删除tablespace
			DROP TABLESPACE DSSJC_LOCAL_DATA INCLUDING CONTENTS AND DATAFILES;
			DROP TABLESPACE DSSJC_LOCAL_TEMP INCLUDING CONTENTS AND DATAFILES;
	查看表空间被什么结构占用
		select * from
		(select owner,SEGMENT_NAME,segment_type,TABLESPACE_NAME,bytes/1024/1024 MB 
		from dba_segments 
		where TABLESPACE_NAME='&tbs_name'
		order by mb desc)
		where rownum < 11;


	查看表空间存储那些数据

		SELECT TABLESPACE_NAME  AS TABLESPACE_NAME,SEGMENT_NAME AS SEGMENT_NAME,SUM(BYTES)/1024/1024 AS SEGMENT_SIZE FROM DBA_SEGMENTS WHERE TABLESPACE_NAME LIKE 'SYSTEM'
		GROUP BY TABLESPACE_NAME,SEGMENT_NAME 
		ORDER BY 3;

	/*查询表空间中对象的详细信息*/
		SELECT OWNER                  AS OWNER
		      ,SEGMENT_NAME           AS SEGMENT_NAME
		      ,SEGMENT_TYPE           AS SEGMENT_TYPE
		      ,SUM(BYTES)/1024/1024   AS SEGMENT_SIZE
		FROM DBA_SEGMENTS
		WHERE TABLESPACE_NAME=&TABLESPACE_NAME
		GROUP BY OWNER,SEGMENT_NAME,SEGMENT_TYPE
		ORDER BY 4;


	查看表空间对象
		SELECT OWNER         AS OWNER
		      ,'TABLE'       AS SEGMENT_TYPE
		      ,TABLE_NAME    AS SEGMENT_NAME
		FROM DBA_TABLES 
		WHERE TABLESPACE_NAME=&TABLESPACE_NAME
		UNION ALL
		SELECT OWNER         AS OWNER
		      ,'INDEX'       AS SEGMENT_TYPE
		      ,INDEX_NAME    AS SEGMETN_NAME
		FROM DBA_INDEXES 
		WHERE TABLESPACE_NAME=&TABLESPACE_NAME
		UNION ALL
		SELECT OWNER         AS OWNER
		      ,'LOBSEGMENT'  AS SGEMENT_TYPE
		      ,SEGMENT_NAME  AS SEGMENT_NAME
		FROM DBA_LOBS 
		WHERE TABLESPACE_NAME=&TABLESPACE_NAME;


	查看表空间对应的数据文件：

		select tablespace_name, file_id,file_name, 
		round(bytes/(1024*1024),0) total_space from dba_data_files order by tablespace_name;

		select tablespace_name, file_id,file_name, 
		round(bytes/(1024*1024),0) total_space from dba_data_files order by tablespace_name;

		alter tablespace USERS 
		add datafile '/u01/app/oracle/oradata/orcl/users02.dbf' size 25600m 
		autoextend on next 50m;

		alter tablespace SYSTEM 
		add datafile '/u01/app/oracle/oradata/orcl/system02.dbf' size 10240m 
		autoextend on next 50m;












--1、查看表空间的名称及大小 
SELECT t.tablespace_name, round(SUM(bytes / (1024 * 1024)), 0) ts_size 
FROM dba_tablespaces t, dba_data_files d 
WHERE t.tablespace_name = d.tablespace_name 
GROUP BY t.tablespace_name; 
--2、查看表空间物理文件的名称及大小 
SELECT tablespace_name, 
file_id, 
file_name, 
round(bytes / (1024 * 1024), 0) total_space 
FROM dba_data_files 
ORDER BY tablespace_name; 
--3、查看回滚段名称及大小 
SELECT segment_name, 
tablespace_name, 
r.status, 
(initial_extent / 1024) initialextent, 
(next_extent / 1024) nextextent, 
max_extents, 
v.curext curextent 
FROM dba_rollback_segs r, v$rollstat v 
WHERE r.segment_id = v.usn(+) 
ORDER BY segment_name; 
--4、查看控制文件 
SELECT NAME FROM v$controlfile; 
--5、查看日志文件 
SELECT MEMBER FROM v$logfile; 
--6、查看表空间的使用情况 
SELECT SUM(bytes) / (1024 * 1024) AS free_space, tablespace_name 
FROM dba_free_space 
GROUP BY tablespace_name; 
SELECT a.tablespace_name, 
a.bytes total, 
b.bytes used, 
c.bytes free, 
(b.bytes * 100) / a.bytes "% USED ", 
(c.bytes * 100) / a.bytes "% FREE " 
FROM sys.sm$ts_avail a, sys.sm$ts_used b, sys.sm$ts_free c 
WHERE a.tablespace_name = b.tablespace_name 
AND a.tablespace_name = c.tablespace_name; 
--7、查看数据库库对象 
SELECT owner, object_type, status, COUNT(*) count# 
FROM all_objects 
GROUP BY owner, object_type, status; 
--8、查看数据库的版本　 
SELECT version 
FROM product_component_version 
WHERE substr(product, 1, 6) = 'Oracle'; 
--9、查看数据库的创建日期和归档方式 
SELECT created, log_mode, log_mode FROM v$database; 
--1G=1024MB 
--1M=1024KB 
--1K=1024Bytes 
--1M=11048576Bytes 
--1G=1024*11048576Bytes=11313741824Bytes 
SELECT a.tablespace_name "表空间名", 
total "表空间大小", 
free "表空间剩余大小", 
(total - free) "表空间使用大小", 
total / (1024 * 1024 * 1024) "表空间大小(G)", 
free / (1024 * 1024 * 1024) "表空间剩余大小(G)", 
(total - free) / (1024 * 1024 * 1024) "表空间使用大小(G)", 
round((total - free) / total, 4) * 100 "使用率 %" 
FROM (SELECT tablespace_name, SUM(bytes) free 
FROM dba_free_space 
GROUP BY tablespace_name) a, 
(SELECT tablespace_name, SUM(bytes) total 
FROM dba_data_files 
GROUP BY tablespace_name) b 
WHERE a.tablespace_name = b.tablespace_name 




--按照数据行数排序
select table_name,blocks,num_rows 
from dba_tables 
where owner not like '%SYS%' and table_name not like '%$%' and num_rows is not null
order by num_rows desc;
--按照表占用的数据块
select table_name,blocks,num_rows 
from dba_tables 
where owner not like '%SYS%' and table_name not like '%$%' and blocks is not null
order by blocks desc;















SELECT D.TABLESPACE_NAME,
       SPACE || 'M' "SUM_SPACE(M)",
       BLOCKS "SUM_BLOCKS",
       SPACE - NVL(FREE_SPACE, 0) || 'M' "USED_SPACE(M)",
       ROUND((1 - NVL(FREE_SPACE, 0) / SPACE) * 100, 2) || '%' "USED_RATE(%)",
       FREE_SPACE || 'M' "FREE_SPACE(M)"
  FROM (SELECT TABLESPACE_NAME,
               ROUND(SUM(BYTES) / (1024 * 1024), 2) SPACE,
               SUM(BLOCKS) BLOCKS
          FROM DBA_DATA_FILES
         GROUP BY TABLESPACE_NAME) D,
       (SELECT TABLESPACE_NAME,
               ROUND(SUM(BYTES) / (1024 * 1024), 2) FREE_SPACE
          FROM DBA_FREE_SPACE
         GROUP BY TABLESPACE_NAME) F
 WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME(+)
UNION ALL
SELECT D.TABLESPACE_NAME,
       SPACE || 'M' "SUM_SPACE(M)",
       BLOCKS SUM_BLOCKS,
       USED_SPACE || 'M' "USED_SPACE(M)",
       ROUND(NVL(USED_SPACE, 0) / SPACE * 100, 2) || '%' "USED_RATE(%)", 
       NVL(FREE_SPACE, 0) || 'M' "FREE_SPACE(M)"
  FROM (SELECT TABLESPACE_NAME,
               ROUND(SUM(BYTES) / (1024 * 1024), 2) SPACE,
               SUM(BLOCKS) BLOCKS
          FROM DBA_TEMP_FILES
         GROUP BY TABLESPACE_NAME) D,
       (SELECT TABLESPACE_NAME,
               ROUND(SUM(BYTES_USED) / (1024 * 1024), 2) USED_SPACE,
               ROUND(SUM(BYTES_FREE) / (1024 * 1024), 2) FREE_SPACE
          FROM V$TEMP_SPACE_HEADER
         GROUP BY TABLESPACE_NAME) F
 WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME(+)
 ORDER BY 1;


